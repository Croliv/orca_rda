<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gerador de Orçamento</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <style>
    :root {
      --accent: #f07f1a;
      --dark: #111;
    }

    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f8;
      color: #222;
    }

    .app {
      max-width: 1100px;
      margin: 20px auto;
      padding: 18px;
    }

    .layout {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    form.panel {
      width: 380px;
      background: #fff;
      padding: 50px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .08);
    }

    .preview {
      flex: 1;
      background: #fff;
      padding: 18px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .08);
    }

    h2 {
      margin: 0 0 12px 0;
      font-size: 18px
    }

    label {
      display: block;
      font-weight: 700;
      margin-top: 10px;
      font-size: 13px
    }

    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 95%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      margin-top: 6px;
      font-size: 14px;
    }

    #pricingMode,#unitLocation {
      width: 100%;
      font-size: 16px;
      /* opcional, para harmonizar com os inputs */
      padding: 5px 10px;
      /* opcional, melhora o espaçamento interno */
    }


    textarea {
      width: 200px;
      /* largura fixa */
      height: 35px;
      /* altura fixa */
      resize: none;
      /* desativa o redimensionamento manual */
    }


    .row {
      display: flex;
      gap: 8px
    }

    .row>* {
      flex: 1
    }

    button {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 14px 14px;
      border-radius: 20px;
      cursor: pointer;
    }

    button.secondary {
      background: #666
    }

    .items {
      margin-top: 10px
    }

    table {
      width: 100%;
      border-collapse: collapse
    }

    table th,
    table td {
      font-size: 13px;
      padding: 6px;
      border-bottom: 1px solid #eee;
      text-align: left;
      vertical-align: top
    }

    .muted {
      color: #666;
      font-size: 13px
    }

    /* PREVIEW CONTRACT STYLES */
    .contract {
      background: #fff;
      padding: 18px;
      color: #111;
      border: 1px solid #ddd;
      position: relative;
      overflow: hidden
    }

    .contract .header {
      display: flex;
      align-items: center;
      gap: 14px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 12px;
      margin-bottom: 10px
    }

    .logoBox {
      width: 240px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center
    }

    .companyData {
      font-size: 12px
    }

    .contract h1 {
      font-size: 18px;
      margin: 10px 0;
      text-align: center;
      text-decoration: underline
    }

    .section {
      margin: 10px 0;
      font-size: 14px
    }

    .itemsTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px
    }

    .itemsTable th,
    .itemsTable td {
      border: 1px solid #ccc;
      padding: 6px;
      font-size: 13px
    }

    .totals {
      font-size: 16px;
      margin-top: 8px;
      font-weight: 700;
      text-align: right
    }

    .sign {
      display: flex;
      justify-content: space-between;
      margin-top: 32px
    }

    .sign .line {
      width: 40%;
      text-align: center
    }

        /* Data do contrato */
    .contract .small {
      text-align: center;
      margin-top: 20px; /* adiciona um espaço acima */
      font-size: 12px;
      color: #666;
      font-weight: bold;
    }
    
    /* Rodapé com direitos reservados */
    .contract footer.note {
      text-align: center;
      margin-top: 0px; /* separa do texto acima */
      font-size: 10px;
      color: #666;
    }

    .topButtons {
      display: flex;
      gap: 8px;
      justify-content: space-between;
      margin-bottom: 12px
    }

    .muted-small {
      font-size: 12px;
      color: #666
    }

    .left-info {
      text-align: left;
      margin-top: 10px;
    }


    /* Marca d’água */
    #watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-25%, -10%) rotate(-0deg);
      opacity: 0.55;
      width: 70%;
      height: auto;
      z-index: 0;
      pointer-events: none;
    }

    .contract *:not(#watermark) {
      position: relative;
      z-index: 1;
    }

    .small-text {
      font-size: 12px;
      text-align: left;
      margin-top: 8px;
    }


    /* print settings */
    @media print {
      body {
        background: white
      }

      .app {
        max-width: 100%;
        margin: 0;
        padding: 0
      }

      .layout {
        flex-direction: column
      }

      form.panel,
      .topButtons {
        display: none
      }

      .contract {
        border: none;
        padding: 0
      }
    }

    .preview-images {
      margin: 12px 0 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      align-items: flex-start;
    }

    @media (max-width:800px) {
      .preview-images img {
        max-width: 48%
      }
    }

    @media (max-width:480px) {
      .preview-images img {
        max-width: 100%
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topButtons">
      <div class="muted-small">&nbsp;</div>
      <div>
        <button id="btnPrint">Exportar / Salvar PDF</button>
        <button id="btnReset" class="secondary">Limpar formulário</button>
      </div>
    </div>

    <div class="layout">
      <!-- FORM -->
      <form class="panel" id="form">
        <h2>Dados do Orçamento</h2>
        <label>Fotos do Projeto</label>
        <div style="display:flex;align-items:flex-start;gap:12px;">
          <!-- coluna esquerda: botão + lista de nomes -->
          <div style="flex:1">
            <div style="display:flex;align-items:center;gap:8px;">
              <!-- botão customizado abre o file picker -->
              <label for="projectImages"
                style="background:var(--accent);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">
                Escolher arquivos
              </label>
              <span id="fileCount" class="muted-small"></span>
            </div>

            <!-- input escondido (label abre ele) -->
            <input type="file" id="projectImages" accept="image/*" multiple style="display:none;">

            <!-- aqui aparece a lista: só nome + tamanho + botão remover -->
            <div id="fileList"></div>
          </div>

          <!-- a coluna direita fica vazia aqui; o preview continuará sendo colocado
       no #previewImages que já existe dentro da pré-visualização do contrato -->
        </div>

        <div>
          <label>Nome da Empresa / Contratada</label>
          <input type="text" id="companyName" value="SOUZA E CAVALCATE ACM E VIDRO LTDA">

          <label>CNPJ</label>
          <input type="text" id="companyCNPJ" value="62.252.910/0001-19">

          <label>Endereço da Empresa</label>
          <input type="text" id="companyAddress" value="Rua Santinho Veloso, Q32 LT012 ST - St. Pauzanes, Rio Verde - GO">

          <label>Contato (Telefone / E-mail)</label>
          <input type="text" id="companyContact" value="(64) 99268-8158 • reidoacmrv@gmail.com">

          <hr>

          <label>Nome do Contratante</label>
          <input type="text" id="clientName" value="">

          <label>CPF / CNPJ</label>
          <input type="text" id="clientCPF" value="" maxlength="18">

          <label>Celular do Contratante</label>
          <input type="text" id="clientPhone" value="" maxlength="15">


          <label>Endereço do Contratante</label>
          <input type="text" id="clientAddress" value="">
        </div>
        <hr>

        <div style="display:flex; align-items:center; gap:138px;">
          <label for="deliveryForecast">Previsão de Entrega</label>
          <input type="date" id="deliveryForecast">
        </div>




        <hr>

        <label>Modo de orçamento</label>
        <div class="items">
          <select id="pricingMode">
            <option value="unit">Detalhado</option>
            <option value="total">Valor Total</option>
          </select>
          <table id="itemsInputTable">
            <thead>
              <tr>
                <th>Descrição</th>
                <th style="width:80px">Qtd</th>
                <th style="width:80px">Unid</th>
                <th style="width:110px">Valor unit.</th>
                <th style="width:40px"></th>
              </tr>
            </thead>
            <tbody id="itemsTbody"></tbody>
          </table>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button type="button" id="addItem">Adicionar item</button>
            <button type="button" id="clearItems" class="secondary">Limpar itens</button>
          </div>
        </div>

        <hr>

        <label>Unidade emissora</label>
        <select id="unitLocation">
          <option value="Rio Verde – Goiás">Rio Verde – Goiás</option>
          <option value="Quirinópolis – Goiás">Quirinópolis – Goiás</option>
        </select>

      </form>

      <!-- PREVIEW -->
      <div class="preview">
        <div class="contract" id="contractPreview">
          <img id="watermark" src="/marca-dagua.png" alt="Marca d'água">

          <div class="header">
            <div id="logoPreview" class="logoBox">
              <img src="/logo-rda.png" style="max-width:100%;max-height:70px;object-fit:contain" alt="logo" />
            </div>
            <div class="companyData">
              <div id="previewCompanyName" style="font-weight:700">SOUZA E CAVALCATE ACM E VIDRO LTDA</div>
              <div id="previewCNPJ" class="muted">62.252.910/0001-19</div>
              <div id="previewCompanyAddr" class="muted">Rua Santinho Veloso, Q32 LT012 ST - St. Pauzanes, Rio Verde - GO</div>
              <div id="previewCompanyContact" class="muted">(64)99268-8158 • reidoacmrv@gmail.com</div>
            </div>
          </div>

          <div style="text-align:center; margin-bottom:10px;">
            <h2 style="margin:0;">ORÇAMENTO</h2>
            <div id="budgetNumber" style="font-size:14px; font-weight:normal; color:#444;"></div>
          </div>



          <div id="previewImages" class="preview-images" aria-hidden="false"></div>

          <div class="section">
            <strong>CONTRATANTE</strong>
            <div>Nome: <span id="previewClientName"></span></div>
            <div><span id="previewClientCPF" class="muted"></span></div>
            <div id="previewClientPhoneRow">Celular: <span id="previewClientPhone" class="muted"></span></div>
            <div id="previewClientAddrRow">Endereço: <span id="previewClientAddr" class="muted"></span></div>
          </div>

          <div class="section">
            <strong>CONTRATADO</strong>
            <div id="previewContractedText" class="muted">
              <span id="previewContractedName"></span>, pessoa jurídica de direito privado, inscrita no CNPJ sob o n.º
              <span id="previewContractedCNPJ"></span>.
            </div>
          </div>

          <div class="section">
            <strong>OBJETO</strong>
            <div>É objeto do presente orçamento a prestação dos serviços e fornecimento de:</div>

            <table class="itemsTable" id="previewItemsTable">
              <thead id="itemsTableHead"></thead>
              <tbody></tbody>
            </table>

            <div class="totals">
              <div>Subtotal: R$ <span id="previewSubtotal">0.00</span></div>
              <div>Entrada (50%): R$ <span id="previewEntrada">0.00</span></div>
              <div>Total: R$ <span id="previewTotal">0.00</span></div>
              <div id="previewDeliveryRow" class="small-text" style="display:none;">
                Previsão de entrega: <span id="previewDelivery"></span>
              </div>

              <div id="previewValidityRow" class="small-text">
                Validade do orçamento: <span id="previewValidity"></span>
              </div>
            </div>
          </div>

          <div class="section small">
            <div id="previewContractDate"></div>
          </div>

          <footer class="note">© 2025 REI do ACM. Todos os direitos reservados.</footer>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    let items = [];

    function toCurrency(v) {
      if (isNaN(v)) v = 0;
      return Number(v).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function renderItemsInputs() {
      const tbody = document.getElementById('itemsTbody');
      tbody.innerHTML = '';
      const mode = document.getElementById('pricingMode').value;

      items.forEach((it, idx) => {
        const tr = document.createElement('tr');
        if (mode === 'unit') {
          tr.innerHTML = `
            <td><textarea data-idx="${idx}" data-field="desc">${it.desc || ''}</textarea></td>
            <td><input type="number" min="0" data-idx="${idx}" data-field="qty" value="${it.qty || 1}" /></td>
            <td><input type="text" data-idx="${idx}" data-field="unit" value="${it.unit || ''}" /></td>
            <td><input type="number" min="0" step="0.01" data-idx="${idx}" data-field="price" value="${it.price || 0}" /></td>
            <td><button type="button" data-idx="${idx}" class="removeItem">x</button></td>
          `;
        } else {
          tr.innerHTML = `
            <td><textarea data-idx="${idx}" data-field="desc">${it.desc || ''}</textarea></td>
            <td colspan="2"></td>
            <td><input type="number" min="0" step="0.01" data-idx="${idx}" data-field="total" value="${it.total || 0}" /></td>
            <td><button type="button" data-idx="${idx}" class="removeItem">x</button></td>
          `;
        }
        tbody.appendChild(tr);
      });

      tbody.querySelectorAll('textarea, input').forEach(inp => {
        inp.addEventListener('input', (e) => {
          const idx = +e.target.dataset.idx;
          const f = e.target.dataset.field;
          if (f === 'qty') items[idx].qty = Number(e.target.value) || 0;
          else if (f === 'price') items[idx].price = Number(e.target.value) || 0;
          else if (f === 'total') items[idx].total = Number(e.target.value) || 0;
          else if (f === 'desc') items[idx].desc = e.target.value;
          else if (f === 'unit') items[idx].unit = e.target.value;
          updatePreview();
        });
      });

      tbody.querySelectorAll('.removeItem').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = +btn.dataset.idx;
          items.splice(idx, 1);
          renderItemsInputs();
          updatePreview();
        });
      });
    }

    function addSampleItems() {
      items = [
        { desc: '01 COBERTURA EM POLICARBONATO...', qty: 1, unit: 'un', price: 0 }
      ];
      renderItemsInputs();
    }

    function updatePreview() {
      // empresa / contratado
      document.getElementById('previewCompanyName').textContent = document.getElementById('companyName').value || '';
      document.getElementById('previewCNPJ').textContent = 'CNPJ: ' + (document.getElementById('companyCNPJ').value || '');
      document.getElementById('previewCompanyAddr').textContent = document.getElementById('companyAddress').value || '';
      document.getElementById('previewCompanyContact').textContent = document.getElementById('companyContact').value || '';

      // contratante
      document.getElementById('previewClientName').textContent = document.getElementById('clientName').value || '';
      const cpfCnpjInput = document.getElementById('clientCPF').value || '';
      const digits = cpfCnpjInput.replace(/\D/g, ''); // só números
      let cpfCnpjLabel = 'CPF/CNPJ';

      if (digits.length === 11) {
        cpfCnpjLabel = 'CPF';
      } else if (digits.length === 14) {
        cpfCnpjLabel = 'CNPJ';
      }

      document.getElementById('previewClientCPF').textContent =
        cpfCnpjInput ? `${cpfCnpjLabel}: ${cpfCnpjInput}` : '';

      // Máscara automática para celular
      document.getElementById('clientPhone').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, ''); // mantém só números

        // (99) 99999-9999
        if (value.length > 0) {
          value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
          value = value.replace(/(\d{5})(\d)/, '$1-$2');
        }

        e.target.value = value.substring(0, 15); // limita no formato
      });


      // Atualiza celular
      const phoneValue = document.getElementById('clientPhone').value.trim();
      document.getElementById('previewClientPhone').textContent = phoneValue;

      // Mostra/esconde linha do celular
      const phoneRow = document.getElementById('previewClientPhoneRow');
      if (phoneRow) {
        phoneRow.style.display = phoneValue ? '' : 'none';
      }


      // Atualiza endereço
      const addrValue = document.getElementById('clientAddress').value.trim();
      document.getElementById('previewClientAddr').textContent = addrValue;

      // Mostra/esconde linha do endereço
      const addrRow = document.getElementById('previewClientAddrRow');
      if (addrRow) {
        addrRow.style.display = addrValue ? '' : 'none';
      }


      // contratado (texto)
      document.getElementById('previewContractedName').textContent = document.getElementById('companyName').value || '';
      document.getElementById('previewContractedCNPJ').textContent = document.getElementById('companyCNPJ').value || '';

      // cabeçalho dinâmico
      const mode = document.getElementById('pricingMode').value;
      const thead = document.getElementById('itemsTableHead');
      if (mode === 'unit') {
        thead.innerHTML = `
          <tr>
            <th>Descrição</th>
            <th>Qtd</th>
            <th>Unid</th>
            <th>Valor unit.</th>
            <th>Subtotal</th>
          </tr>`;
      } else {
        thead.innerHTML = `
          <tr>
            <th>Descrição</th>
            <th colspan="4">Valor</th>
          </tr>`;
      }

      // itens na prévia
      const tbody = document.querySelector('#previewItemsTable tbody');
      tbody.innerHTML = '';
      let subtotal = 0;
      items.forEach(it => {
        const tr = document.createElement('tr');
        if (mode === 'unit') {
          const st = (it.qty || 0) * (it.price || 0);
          subtotal += st;
          tr.innerHTML = `
            <td style="white-space:pre-line">${it.desc || ''}</td>
            <td>${it.qty || ''}</td>
            <td>${it.unit || ''}</td>
            <td>${toCurrency(it.price || 0)}</td>
            <td>${toCurrency(st)}</td>`;
        } else {
          subtotal += (it.total || 0);
          tr.innerHTML = `
            <td style="white-space:pre-line">${it.desc || ''}</td>
            <td colspan="4">${toCurrency(it.total || 0)}</td>`;
        }
        tbody.appendChild(tr);
      });

      function generateBudgetNumber() {
        // enquanto o Google Sheets não responder
        return 'Carregando...';
      }


      document.addEventListener('DOMContentLoaded', () => {
        const budgetNumberElement = document.getElementById('budgetNumber');
        if (budgetNumberElement) {
          budgetNumberElement.textContent = generateBudgetNumber();
        }
      });


      document.getElementById('previewSubtotal').textContent = toCurrency(subtotal);
      document.getElementById('previewEntrada').textContent = toCurrency(subtotal / 2);
      document.getElementById('previewTotal').textContent = toCurrency(subtotal);

      // Previsão de entrega (manual via campo de data)
      const deliveryInput = document.getElementById('deliveryForecast').value;

      if (deliveryInput) {
        const deliveryDate = new Date(deliveryInput);
        const options = { year: 'numeric', month: 'long', day: 'numeric' };

        // Exibe no formato: "30 de setembro de 2025"
        document.getElementById('previewDelivery').textContent =
          deliveryDate.toLocaleDateString('pt-BR', options);

        document.getElementById('previewDeliveryRow').style.display = '';
      } else {
        // Se não preencher nada → oculta a linha
        document.getElementById('previewDeliveryRow').style.display = 'none';
      }


      // Validade do orçamento (automática: +30 dias)
      const validityDays = 30; // você pode mudar para 15, 30...
      const nowDate = new Date();
      const validUntil = new Date(nowDate);
      validUntil.setDate(nowDate.getDate() + validityDays);

      const validityOptions = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('previewValidity').textContent =
        validUntil.toLocaleDateString('pt-BR', validityOptions);

      // unidade e data
      const unit = document.getElementById('unitLocation').value;
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('previewContractDate').textContent =
        unit + ', ' + now.toLocaleDateString('pt-BR', options);
    }

    document.getElementById('addItem').addEventListener('click', () => {
      items.push({ desc: '', qty: 1, unit: '', price: 0 });
      renderItemsInputs();
      updatePreview();
    });

    document.getElementById('clearItems').addEventListener('click', () => {
      items = [];
      renderItemsInputs();
      updatePreview();
    });

    document.getElementById('pricingMode').addEventListener('change', () => {
      renderItemsInputs();
      updatePreview();
    });

    document.getElementById('form').addEventListener('input', updatePreview);

    document.getElementById('btnPrint').addEventListener('click', () => {
      const element = document.getElementById('contractPreview');

      // Nome do contratante (primeiro + último)
      let clientName = document.getElementById("clientName").value.trim() || "SemNome";
      const parts = clientName.split(" ");
      if (parts.length > 1) {
        clientName = parts[0] + " " + parts[parts.length - 1];
      } else {
        clientName = parts[0];
      }

      // Número do orçamento (remove "/" para não quebrar o arquivo)
      let budgetNumber = document.getElementById("budgetNumber").textContent.trim();
      budgetNumber = budgetNumber.replace(/\//g, "-");

      // Nome final do arquivo
      const fileName = `Orçamento - ${clientName} - ${budgetNumber}.pdf`;

      html2pdf().set({
        margin: 10,
        filename: fileName,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    });


    document.getElementById('btnReset').addEventListener('click', () => {
      // --- seus clears já existentes (exemplo) ---
      document.getElementById('clientName').value = '';
      document.getElementById('clientCPF').value = '';
      document.getElementById('clientAddress').value = '';
      document.getElementById('clientPhone').value = '';
      document.getElementById('unitLocation').value = 'Rio Verde – Goiás';

      // limpa items e preview relacionados
      items = [];
      renderItemsInputs();
      updatePreview();

      // --- limpeza das imagens e da lista ---
      const projectInput = document.getElementById('projectImages');
      const previewImages = document.getElementById('previewImages');
      const fileList = document.getElementById('fileList');
      const fileCount = document.getElementById('fileCount');

      if (projectInput) projectInput.value = '';
      if (previewImages) previewImages.innerHTML = '';
      if (fileList) fileList.innerHTML = '';
      if (fileCount) fileCount.textContent = '';

      // zera o array de arquivos selecionados (garante que não fica resíduo)
      if (typeof selectedFiles !== 'undefined') {
        selectedFiles.length = 0; // limpa mantendo referência
      } else {
        // fallback: declara global se não existir
        window.selectedFiles = [];
      }

      // atualiza o input.files para refletir que não há arquivos
      if (typeof updateFileInput === 'function') updateFileInput();

      // re-renderiza a lista/preview caso sejam usadas por outras funções
      if (typeof renderFiles === 'function') renderFiles();
    });


    // elementos
    const projectInput = document.getElementById('projectImages');
    const fileList = document.getElementById('fileList');
    const previewContainer = document.getElementById('previewImages');
    const fileCount = document.getElementById('fileCount');

    // array com os arquivos realmente selecionados
    let selectedFiles = [];

    // quando o usuário escolher arquivos
    projectInput.addEventListener('change', (e) => {
      const newFiles = Array.from(e.target.files || []);

      // adiciona sem duplicar (mesmo name+size)
      newFiles.forEach(f => {
        if (!selectedFiles.some(sf => sf.name === f.name && sf.size === f.size)) {
          selectedFiles.push(f);
        }
      });

      updateFileInput();
      renderFiles();
    });

    // renderiza lista (esquerda) e thumbs (direita)
    function renderFiles() {
      fileList.innerHTML = '';
      previewContainer.innerHTML = '';

      fileCount.textContent = selectedFiles.length ? `${selectedFiles.length} arquivo(s)` : '';

      selectedFiles.forEach((file, index) => {
        // LISTA (nome + tamanho + botão)
        const item = document.createElement('div');
        item.style.display = 'flex';
        item.style.alignItems = 'center';
        item.style.justifyContent = 'space-between';
        item.style.gap = '8px';
        item.style.marginTop = '6px';
        item.style.paddingRight = '6px';

        const name = document.createElement('span');
        name.textContent = `${file.name} (${formatFileSize(file.size)})`;
        name.style.flex = '1';
        name.style.wordBreak = 'break-word';
        name.style.fontSize = '12px';   // menor que o normal
        name.style.color = '#555';      // cinza mais discreto


        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = '✖';
        btn.style.background = 'transparent';
        btn.style.border = 'none';
        btn.style.color = 'red';
        btn.style.cursor = 'pointer';
        btn.style.fontSize = '14px';
        btn.addEventListener('click', () => {
          // remove do array e re-renderiza
          selectedFiles.splice(index, 1);
          updateFileInput();
          renderFiles();
        });

        item.appendChild(name);
        item.appendChild(btn);
        fileList.appendChild(item);

        // PREVIEW (direita) — só para imagens
        if (file.type && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (ev) => {
            const img = document.createElement('img');
            img.src = ev.target.result;
            img.style.maxWidth = '100%';
            img.style.height = 'auto';
            img.style.border = '1px solid #ddd';
            img.style.borderRadius = '10px';
            img.style.display = 'block';
            previewContainer.appendChild(img);
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // atualiza projectInput.files para refletir seleção atual (necessário para upload/export)
    function updateFileInput() {
      const dataTransfer = new DataTransfer();
      selectedFiles.forEach(f => dataTransfer.items.add(f));
      projectInput.files = dataTransfer.files;
    }

    // formata bytes pra KB/MB
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 B';
      if (bytes < 1024) return `${bytes} B`;
      if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
      return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
    }


    // Máscara automática CPF ou CNPJ
    document.getElementById('clientCPF').addEventListener('input', function (e) {
      let value = e.target.value.replace(/\D/g, ''); // mantém só números

      if (value.length <= 11) {
        // CPF
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      } else {
        // CNPJ
        value = value.replace(/^(\d{2})(\d)/, '$1.$2');
        value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
        value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
        value = value.replace(/(\d{4})(\d)/, '$1-$2');
      }

      e.target.value = value;
    });

    async function getNextBudgetNumber() {
      const url = "https://script.google.com/macros/s/AKfycbyiU7ciKhaJdfJ0PYMUi6c6vVZev8Rq8NtEM7zwbBBfzY1YiE8VqE8BylYGOJQ1uX7EBQ/exec";
      const response = await fetch(url);
      const data = await response.json();

      const year = new Date().getFullYear();
      return `Nº ${data.numero}/${year}`;
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const budgetNumberElement = document.getElementById('budgetNumber');
      if (budgetNumberElement) {
        budgetNumberElement.textContent = await getNextBudgetNumber();
      }
    });


    addSampleItems();
    updatePreview();
  </script>
</body>


</html>













